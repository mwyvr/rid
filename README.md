[![godoc](http://img.shields.io/badge/godev-reference-blue.svg?style=flat)](https://pkg.go.dev/github.com/solutionroute/rid?tab=doc)[![Test](https://github.com/solutionroute/rid/actions/workflows/test.yaml/badge.svg)](https://github.com/solutionroute/rid/actions/workflows/test.yaml)[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

# rid

Package rid provides a performant, k-sortable, scalable unique ID generator
suitable for single process applications or situations where inter-process ID
generation coordination is not required.

Binary IDs Base-32 encode as a 16-character URL-friendly representation like
dfp7qt0v2pwt0v2x.

The 10-byte binary representation of an ID is comprised of:

  - 4-byte timestamp value representing seconds since the Unix epoch
  - 6-byte random value; see fastrandUint64 [1]; 48 bits of randomness per
    second more than meets most application needs

Key features:

  - K-orderable in both binary and string representations
  - It's short
  - Automatic (de)serialization for SQL dbs and JSON
  - Scalable performance as cores are added; ID generation is way faster than it needs to be
  - URL-friendly Base32 encoding using a custom character set to help avoid unintended rude words

Example:

```go
	id := rid.New()
	fmt.Printf("%s", id.String())
	// Output: dfp7qt97menfv8ll
```

Acknowledgement: This package borrows heavily from rs/xid
(https://github.com/rs/xid), a capable zero-configuration globally-unique ID
package which itself levers ideas from MongoDB
(https://docs.mongodb.com/manual/reference/method/ObjectId/).

## Batteries included

`rid.ID` implements a number of common interfaces to make it convenient to use
in applications interacting via JSON or a database:

- database/sql: driver.Valuer, sql.Scanner
- encoding: TextMarshaler, TextUnmarshaler
- encoding/json: json.Marshaler, json.Unmarshaler
- Stringer

Package `rid` also provides a command line tool `rid` allowing for id generation
and inspection. 

    $ rid 
	dfpb18y8dg90hc74

 	$ rid -c 2
	dfp9l9cgs05blztq
	dfp9l9d80yxdf804

    # produce 4 and inspect
	$ rid `rid -c 4`
	dfp9lmz9ksw87w48 ts:1672255955 rnd:256798116540552 2022-12-28 11:32:35 -0800 PST ID{0x63,0xac,0x99,0xd3,0xe9,0x8e,0x78,0x83,0xf0,0x88}
	dfp9lmxefym2ht2f ts:1672255955 rnd:190729433933902 2022-12-28 11:32:35 -0800 PST ID{0x63,0xac,0x99,0xd3,0xad,0x77,0xa8,0x28,0x68,0x4e}
	dfp9lmt5zjy7km9n ts:1672255955 rnd: 76951796109621 2022-12-28 11:32:35 -0800 PST ID{0x63,0xac,0x99,0xd3,0x45,0xfc,0xbc,0x78,0xd1,0x35}
	dfp9lmxt5sms80m7 ts:1672255955 rnd:204708502569607 2022-12-28 11:32:35 -0800 PST ID{0x63,0xac,0x99,0xd3,0xba,0x2e,0x69,0x94,0x2,0x87}

## Random Source

For random number generation `rid` uses a Go runtime `fastrand64` [1], it's
goroutine safe, fast, and scales well as cores/parallel processes are added.
`fastrand64` is not cryptographically secure, and for the purposes of this
package, it does not need to be.

[1] For more information on fastrand (wyrand) see: https://github.com/wangyi-fudan/wyhash
 and [Go's sources for runtime/stubs.go](https://cs.opensource.google/go/go/+/master:src/runtime/stubs.go;bpv=1;bpt=1?q=fastrand&ss=go%2Fgo:src%2Fruntime%2F).

## Package Comparisons

Comparison table generated by [eval/compare/main.go](eval/compare/main.go):
| Package                                                   |BLen|ELen| K-Sort| 0-Cfg | Encoded ID and Next | Method | Components |
|-----------------------------------------------------------|----|----|-------|-------|---------------------|--------|------------|
| [solutionroute/rid](https://github.com/solutionroute/rid) | 10 | 16 |  true | false | `dfp9xrc809x18cy8`<br>`dfp9xrgfns0kcdb9` | fastrand | 4 byte ts(sec) : 6 byte random |
| [rs/xid](https://github.com/rs/xid)                       | 12 | 20 |  true |  true | `cem9to8p26gf8lg79hqg`<br>`cem9to8p26gf8lg79hr0` | counter | 4 byte ts(sec) : 2 byte mach ID : 2 byte pid : 3 byte monotonic counter |
| [segmentio/ksuid](https://github.com/segmentio/ksuid)     | 20 | 27 |  true |  true | `2JYa0nBQj0roh4JXrx83Hj7WgFy`<br>`2JYa0qkulPJAXZ0i5HtADguzLQ7` | random | 4 byte ts(sec) : 16 byte random |
| [google/uuid](https://github.com/google/uuid)             | 16 | 36 | false |  true | `657b384e-2e1d-4cb9-a2d7-77220be1ff58`<br>`aa9b6984-f686-4458-af5d-5446224de93e` | crypt/rand | v4: 16 bytes random with version & variant embedded |
| [oklog/ulid](https://github.com/oklog/ulid)               | 16 | 26 |  true |  true | `01GND4S89Y7YZKK7HE56VB4ZZ1`<br>`01GND4S89YQ2AYYEE63NT81Z2P` | crypt/rand | 6 byte ts(ms) : 10 byte counter random init per ts(ms) |
| [kjk/betterguid](https://github.com/kjk/betterguid)       | 17 | 20 |  true |  true | `-NKPI93yGPvNU-ovbcgv`<br>`-NKPI93yGPvNU-ovbcgw` | counter | 8 byte ts(ms) : 9 byte counter random init per ts(ms) |

`rid` does not attempt to weigh in as a globally-unique contender. Instead, for
applications with somewhat more modest needs, `rid` generates unique-enough,
random-enough, human and URL-friendly IDs. Quickly.

For a still-relevant comparison of various golang unique unique ID solutions, see:
https://blog.kowalczyk.info/article/JyRZ/generating-good-unique-ids-in-go.html

## Package Benchmarks

Benchmarks for the above noted packages can be found in [eval/bench/bench_test.go](eval/bench/bench_test.go).

### Intel 4-core Dell Latitude 7420 laptop

	$ go test -cpu 1,2,4,8 -benchmem  -run=^$   -bench  ^.*$
	goos: linux
	goarch: amd64
	pkg: github.com/solutionroute/rid/eval/bench
	cpu: 11th Gen Intel(R) Core(TM) i7-1185G7 @ 3.00GHz
	BenchmarkRid            	31547193	        36.11 ns/op	       0 B/op	       0 allocs/op
	BenchmarkRid-2          	60804381	        19.82 ns/op	       0 B/op	       0 allocs/op
	BenchmarkRid-4          	86309307	        12.29 ns/op	       0 B/op	       0 allocs/op
	BenchmarkRid-8          	137731342	         8.703 ns/op	       0 B/op	       0 allocs/op
	BenchmarkXid            	31119572	        38.60 ns/op	       0 B/op	       0 allocs/op
	BenchmarkXid-2          	36497461	        32.85 ns/op	       0 B/op	       0 allocs/op
	BenchmarkXid-4          	56109519	        26.42 ns/op	       0 B/op	       0 allocs/op
	BenchmarkXid-8          	68092052	        16.69 ns/op	       0 B/op	       0 allocs/op
	BenchmarkKsuid          	 3722514	       319.1 ns/op	       0 B/op	       0 allocs/op
	BenchmarkKsuid-2        	 3244016	       375.4 ns/op	       0 B/op	       0 allocs/op
	BenchmarkKsuid-4        	 3035604	       431.1 ns/op	       0 B/op	       0 allocs/op
	BenchmarkKsuid-8        	 2623758	       459.3 ns/op	       0 B/op	       0 allocs/op
	BenchmarkGoogleUuid     	 3508125	       335.3 ns/op	      16 B/op	       1 allocs/op
	BenchmarkGoogleUuid-2   	 5202723	       229.1 ns/op	      16 B/op	       1 allocs/op
	BenchmarkGoogleUuid-4   	 7339621	       161.3 ns/op	      16 B/op	       1 allocs/op
	BenchmarkGoogleUuid-8   	 8935005	       131.9 ns/op	      16 B/op	       1 allocs/op
	BenchmarkUlid           	  146054	      7591 ns/op	    5440 B/op	       3 allocs/op
	BenchmarkUlid-2         	  235464	      4821 ns/op	    5440 B/op	       3 allocs/op
	BenchmarkUlid-4         	  369512	      3033 ns/op	    5440 B/op	       3 allocs/op
	BenchmarkUlid-8         	  571048	      2125 ns/op	    5440 B/op	       3 allocs/op
	BenchmarkBetterguid     	13744688	        81.70 ns/op	      24 B/op	       1 allocs/op
	BenchmarkBetterguid-2   	11271102	        98.90 ns/op	      24 B/op	       1 allocs/op
	BenchmarkBetterguid-4   	 8455604	       139.9 ns/op	      24 B/op	       1 allocs/op
	BenchmarkBetterguid-8   	 6346668	       187.4 ns/op	      24 B/op	       1 allocs/op

### AMD 8-core desktop

    $ go test -cpu 1,2,4,8,16 -benchmem  -run=^$   -bench  ^.*$
    goos: linux
    goarch: amd64
    pkg: github.com/solutionroute/rid/eval/bench
    cpu: AMD Ryzen 7 3800X 8-Core Processor             
    BenchmarkRid              	19931982	        59.28 ns/op	       0 B/op	       0 allocs/op
    BenchmarkRid-2            	39499843	        29.90 ns/op	       0 B/op	       0 allocs/op
    BenchmarkRid-4            	78571719	        15.08 ns/op	       0 B/op	       0 allocs/op
    BenchmarkRid-8     	       154435864	         7.715 ns/op	       0 B/op	       0 allocs/op
    BenchmarkRid-16    	       279988606	         4.317 ns/op	       0 B/op	       0 allocs/op
    BenchmarkXid              	22248019	        52.32 ns/op	       0 B/op	       0 allocs/op
    BenchmarkXid-2            	37339971	       100.9 ns/op	       0 B/op	       0 allocs/op
    BenchmarkXid-4            	22793754	        52.99 ns/op	       0 B/op	       0 allocs/op
    BenchmarkXid-8            	43813854	        33.44 ns/op	       0 B/op	       0 allocs/op
    BenchmarkXid-16           	67285090	        16.89 ns/op	       0 B/op	       0 allocs/op
    BenchmarkKsuid            	 3252950	       362.7 ns/op	       0 B/op	       0 allocs/op
    BenchmarkKsuid-2          	 2198566	       783.1 ns/op	       0 B/op	       0 allocs/op
    BenchmarkKsuid-4          	 1443458	       832.5 ns/op	       0 B/op	       0 allocs/op
    BenchmarkKsuid-8          	 1441783	       838.8 ns/op	       0 B/op	       0 allocs/op
    BenchmarkKsuid-16         	 1407332	       857.6 ns/op	       0 B/op	       0 allocs/op
    BenchmarkGoogleUuid       	 2900432	       352.8 ns/op	      16 B/op	       1 allocs/op
    BenchmarkGoogleUuid-2     	 4841989	       214.2 ns/op	      16 B/op	       1 allocs/op
    BenchmarkGoogleUuid-4     	 9413534	       110.3 ns/op	      16 B/op	       1 allocs/op
    BenchmarkGoogleUuid-8     	18598221	        58.70 ns/op	      16 B/op	       1 allocs/op
    BenchmarkGoogleUuid-16    	29231677	        40.91 ns/op	      16 B/op	       1 allocs/op
    BenchmarkUlid             	  146024	      7890 ns/op	    5440 B/op	       3 allocs/op
    BenchmarkUlid-2           	  276771	      4396 ns/op	    5440 B/op	       3 allocs/op
    BenchmarkUlid-4           	  516540	      2348 ns/op	    5440 B/op	       3 allocs/op
    BenchmarkUlid-8           	  800305	      1476 ns/op	    5440 B/op	       3 allocs/op
    BenchmarkUlid-16          	  764970	      1484 ns/op	    5440 B/op	       3 allocs/op
    BenchmarkBetterguid       	14442830	        80.73 ns/op	      24 B/op	       1 allocs/op
    BenchmarkBetterguid-2     	10107843	       147.2 ns/op	      24 B/op	       1 allocs/op
    BenchmarkBetterguid-4     	 5394602	       260.7 ns/op	      24 B/op	       1 allocs/op
    BenchmarkBetterguid-8     	 4140949	       296.6 ns/op	      24 B/op	       1 allocs/op
    BenchmarkBetterguid-16    	 3173990	       379.9 ns/op	      24 B/op	       1 allocs/op

