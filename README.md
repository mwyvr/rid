[![godoc](http://img.shields.io/badge/godev-reference-blue.svg?style=flat)](https://pkg.go.dev/github.com/solutionroute/rid?tab=doc)[![Test](https://github.com/solutionroute/rid/actions/workflows/test.yaml/badge.svg)](https://github.com/solutionroute/rid/actions/workflows/test.yaml)[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

# rid

Package rid provides a performant, goroutine-safe generator of
[k-sortable](https://en.wikipedia.org/wiki/K-sorted_sequence) unique IDs
suitable for use where inter-process ID generation coordination is not
required.

An ID is a:

  - 4-byte timestamp value representing seconds since the Unix epoch, plus a
  - 6-byte random value; see the [Random Source](#random-source) discussion.

Using a non-standard character set (fewer vowels), IDs Base-32 encode as a
16-character URL-friendly, case-insensitive, representation like
`dfp7qt0v2pwt0v2x`.

Built-in (de)serialization simplifies interacting with SQL databases and JSON.
`cmd/rid` provides the `rid` utility to generate or inspect IDs. Thanks to
fastrand[1], ID generation starts fast and remains so as cores are added.
De-serialization has also been optimized. See [Package
Benchmarks](#package-benchmarks).

Why `rid` as opposed to [alternatives](#package-comparisons)?

  - At 10 bytes binary, 16 bytes Base32 encoded, rid.IDs are short, yet with 48
    bits of uniqueness *per second*, remain unique enough for many use cases.
  - IDs have a truly random component rather than potentially guessable
    monotonic counter.

Acknowledgement: This package borrows heavily from rs/xid
(https://github.com/rs/xid), a zero-configuration globally-unique
high-performance ID generator which itself levers ideas from MongoDB
(https://docs.mongodb.com/manual/reference/method/ObjectId/).

## Example:

```go
id := rid.New()
fmt.Printf("%s\n", id.String())
// Output: dfp7qt97menfv8ll

id2, err := rid.FromString("dfp7qt97menfv8ll")
if err != nil {
	fmt.Println(err)
}
fmt.Printf("%s %d %v\n", id2.Time(), id2.Random(), id2.Bytes())
// Output: dgcgh7ke6xq9se3g
// 2022-12-28 09:24:57 -0800 PST 43582827111027 [99 172 123 233 39 163 106 237 162 115]
```

## CLI

Package `rid` also provides the `rid` tool for id generation and inspection. 

    $ rid 
	dfpb18y8dg90hc74

 	$ rid -c 2
	dfp9l9cgs05blztq
	dfp9l9d80yxdf804

    # produce 4 and inspect
	$ rid `rid -c 4`
	dfp9lmz9ksw87w48 ts:1672255955 rnd:256798116540552 2022-12-28 11:32:35 -0800 PST ID{ 0x63, 0xac, 0x99, 0xd3, 0xe9, 0x8e, 0x78, 0x83, 0xf0, 0x88 }
	dfp9lmxefym2ht2f ts:1672255955 rnd:190729433933902 2022-12-28 11:32:35 -0800 PST ID{ 0x63, 0xac, 0x99, 0xd3, 0xad, 0x77, 0xa8, 0x28, 0x68, 0x4e }
	dfp9lmt5zjy7km9n ts:1672255955 rnd: 76951796109621 2022-12-28 11:32:35 -0800 PST ID{ 0x63, 0xac, 0x99, 0xd3, 0x45, 0xfc, 0xbc, 0x78, 0xd1, 0x35 }
	dfp9lmxt5sms80m7 ts:1672255955 rnd:204708502569607 2022-12-28 11:32:35 -0800 PST ID{ 0x63, 0xac, 0x99, 0xd3, 0xba, 0x2e, 0x69, 0x94,  0x2, 0x87 }

## Random Source

Since cryptographically-secure IDs are not an objective for this package, other
approaches could be considered. For random number generation `rid` uses a Go
internal runtime `fastrand64` [1] which provides single and multi-core
performance benefits.

You may enjoy reading [Fast thread-safe randomness in Go](https://qqq.ninja/blog/post/fast-threadsafe-randomness-in-go/).

[1] For more information on fastrand (wyrand) see: https://github.com/wangyi-fudan/wyhash
 and [Go's sources for runtime/stubs.go](https://cs.opensource.google/go/go/+/master:src/runtime/stubs.go;bpv=1;bpt=1?q=fastrand&ss=go%2Fgo:src%2Fruntime%2F).
 
To satify whether rid.IDs are unique enough for your use case, run
[eval/uniqcheck/main.go](eval/uniqcheck/main.go) with various values for number
of go routines and iterations, or, at the command line, produce 10,000,000 IDs
and use OS utilities to check:

    rid -c 10000000 | sort | uniq -d
    // None output

## Change Log

- 2023-01-23 Replaced stdlib Base32 with unrolled version for decoding performance.
- 2022-12-28 The "10byte" branch was merged to master; the "15byte-historical"
  branch will be left dormant. No major changes are now expected to this
  package; updates will focus on rounding out test coverage, addressing bugs,
  and clean up.

## Contributing

Contributions are welcome.

## Package Comparisons

Comparison table generated by [eval/compare/main.go](eval/compare/main.go):
| Package                                                   |BLen|ELen| K-Sort| 0-Cfg | Encoded ID and Next | Method | Components |
|-----------------------------------------------------------|----|----|-------|-------|---------------------|--------|------------|
| [solutionroute/rid](https://github.com/solutionroute/rid) | 10 | 16 |  true | false | `dfp9xrc809x18cy8`<br>`dfp9xrgfns0kcdb9` | fastrand | 4 byte ts(sec) : 6 byte random |
| [rs/xid](https://github.com/rs/xid)                       | 12 | 20 |  true |  true | `cem9to8p26gf8lg79hqg`<br>`cem9to8p26gf8lg79hr0` | counter | 4 byte ts(sec) : 2 byte mach ID : 2 byte pid : 3 byte monotonic counter |
| [segmentio/ksuid](https://github.com/segmentio/ksuid)     | 20 | 27 |  true |  true | `2JYa0nBQj0roh4JXrx83Hj7WgFy`<br>`2JYa0qkulPJAXZ0i5HtADguzLQ7` | random | 4 byte ts(sec) : 16 byte random |
| [google/uuid](https://github.com/google/uuid)             | 16 | 36 | false |  true | `657b384e-2e1d-4cb9-a2d7-77220be1ff58`<br>`aa9b6984-f686-4458-af5d-5446224de93e` | crypt/rand | v4: 16 bytes random with version & variant embedded |
| [oklog/ulid](https://github.com/oklog/ulid)               | 16 | 26 |  true |  true | `01GND4S89Y7YZKK7HE56VB4ZZ1`<br>`01GND4S89YQ2AYYEE63NT81Z2P` | crypt/rand | 6 byte ts(ms) : 10 byte counter random init per ts(ms) |
| [kjk/betterguid](https://github.com/kjk/betterguid)       | 17 | 20 |  true |  true | `-NKPI93yGPvNU-ovbcgv`<br>`-NKPI93yGPvNU-ovbcgw` | counter | 8 byte ts(ms) : 9 byte counter random init per ts(ms) |

With only 48 bits of randomness per second, `rid` makes no attempt to
weigh in as a globally-unique contender. Instead, for applications with less global 
needs, `rid` generates unique-enough, random-enough, human and URL-friendly
IDs. Quickly.

For a comparison of various Go-based unique ID solutions, see:
https://blog.kowalczyk.info/article/JyRZ/generating-good-unique-ids-in-go.html

## Package Benchmarks

A benchmark suite for the above noted packages can be found in
[eval/bench/bench_test.go](eval/bench/bench_test.go).

### Intel 4-core Dell Latitude 7420 laptop

	$ go test -cpu 1,2,4,8 -benchmem  -run=^$   -bench  ^.*$
	goos: linux
	goarch: amd64
	pkg: github.com/solutionroute/rid/eval/bench
	cpu: 11th Gen Intel(R) Core(TM) i7-1185G7 @ 3.00GHz
	BenchmarkRid            	31547193	        36.11 ns/op	       0 B/op	       0 allocs/op
	BenchmarkRid-2          	60804381	        19.82 ns/op	       0 B/op	       0 allocs/op
	BenchmarkRid-4          	86309307	        12.29 ns/op	       0 B/op	       0 allocs/op
	BenchmarkRid-8          	137731342	         8.703 ns/op	       0 B/op	       0 allocs/op
	BenchmarkXid            	31119572	        38.60 ns/op	       0 B/op	       0 allocs/op
	BenchmarkXid-2          	36497461	        32.85 ns/op	       0 B/op	       0 allocs/op
	BenchmarkXid-4          	56109519	        26.42 ns/op	       0 B/op	       0 allocs/op
	BenchmarkXid-8          	68092052	        16.69 ns/op	       0 B/op	       0 allocs/op
	BenchmarkKsuid          	 3722514	       319.1 ns/op	       0 B/op	       0 allocs/op
	BenchmarkKsuid-2        	 3244016	       375.4 ns/op	       0 B/op	       0 allocs/op
	BenchmarkKsuid-4        	 3035604	       431.1 ns/op	       0 B/op	       0 allocs/op
	BenchmarkKsuid-8        	 2623758	       459.3 ns/op	       0 B/op	       0 allocs/op
	BenchmarkGoogleUuid     	 3508125	       335.3 ns/op	      16 B/op	       1 allocs/op
	BenchmarkGoogleUuid-2   	 5202723	       229.1 ns/op	      16 B/op	       1 allocs/op
	BenchmarkGoogleUuid-4   	 7339621	       161.3 ns/op	      16 B/op	       1 allocs/op
	BenchmarkGoogleUuid-8   	 8935005	       131.9 ns/op	      16 B/op	       1 allocs/op
	BenchmarkUlid           	  146054	      7591 ns/op	    5440 B/op	       3 allocs/op
	BenchmarkUlid-2         	  235464	      4821 ns/op	    5440 B/op	       3 allocs/op
	BenchmarkUlid-4         	  369512	      3033 ns/op	    5440 B/op	       3 allocs/op
	BenchmarkUlid-8         	  571048	      2125 ns/op	    5440 B/op	       3 allocs/op
	BenchmarkBetterguid     	13744688	        81.70 ns/op	      24 B/op	       1 allocs/op
	BenchmarkBetterguid-2   	11271102	        98.90 ns/op	      24 B/op	       1 allocs/op
	BenchmarkBetterguid-4   	 8455604	       139.9 ns/op	      24 B/op	       1 allocs/op
	BenchmarkBetterguid-8   	 6346668	       187.4 ns/op	      24 B/op	       1 allocs/op

### AMD 8-core desktop

	$ go test -cpu 1,2,4,8,16 -benchmem  -run=^$   -bench  ^.*$
	goos: linux
	goarch: amd64
	pkg: github.com/solutionroute/rid/eval/bench
	cpu: AMD Ryzen 7 3800X 8-Core Processor
	BenchmarkRid              	22228062	        52.87 ns/op	       0 B/op	       0 allocs/op
	BenchmarkRid-2            	44609712	        26.65 ns/op	       0 B/op	       0 allocs/op
	BenchmarkRid-4            	86812888	        13.61 ns/op	       0 B/op	       0 allocs/op
	BenchmarkRid-8            	171851486	         6.911 ns/op	       0 B/op	       0 allocs/op
	BenchmarkRid-16           	304566252	         3.950 ns/op	       0 B/op	       0 allocs/op
	BenchmarkXid              	22468870	        51.56 ns/op	       0 B/op	       0 allocs/op
	BenchmarkXid-2            	18829366	        99.73 ns/op	       0 B/op	       0 allocs/op
	BenchmarkXid-4            	22890943	        52.22 ns/op	       0 B/op	       0 allocs/op
	BenchmarkXid-8            	50826528	        32.83 ns/op	       0 B/op	       0 allocs/op
	BenchmarkXid-16           	69667238	        16.94 ns/op	       0 B/op	       0 allocs/op
	BenchmarkKsuid            	 3339842	       358.0 ns/op	       0 B/op	       0 allocs/op
	BenchmarkKsuid-2          	 1893224	       550.4 ns/op	       0 B/op	       0 allocs/op
	BenchmarkKsuid-4          	 1501238	       822.0 ns/op	       0 B/op	       0 allocs/op
	BenchmarkKsuid-8          	 1429920	       864.5 ns/op	       0 B/op	       0 allocs/op
	BenchmarkKsuid-16         	 1429411	       812.4 ns/op	       0 B/op	       0 allocs/op
	BenchmarkGoogleUuid       	 3581971	       317.8 ns/op	      16 B/op	       1 allocs/op
	BenchmarkGoogleUuid-2     	 5637682	       214.9 ns/op	      16 B/op	       1 allocs/op
	BenchmarkGoogleUuid-4     	 9233425	       110.2 ns/op	      16 B/op	       1 allocs/op
	BenchmarkGoogleUuid-8     	20468934	        58.41 ns/op	      16 B/op	       1 allocs/op
	BenchmarkGoogleUuid-16    	29260754	        40.64 ns/op	      16 B/op	       1 allocs/op
	BenchmarkUlid             	  147126	      7827 ns/op	    5440 B/op	       3 allocs/op
	BenchmarkUlid-2           	  279079	      4340 ns/op	    5440 B/op	       3 allocs/op
	BenchmarkUlid-4           	  456847	      2373 ns/op	    5440 B/op	       3 allocs/op
	BenchmarkUlid-8           	  761228	      1446 ns/op	    5440 B/op	       3 allocs/op
	BenchmarkUlid-16          	  827018	      1490 ns/op	    5440 B/op	       3 allocs/op
	BenchmarkBetterguid       	14381742	        81.16 ns/op	      24 B/op	       1 allocs/op
	BenchmarkBetterguid-2     	13150965	        89.88 ns/op	      24 B/op	       1 allocs/op
	BenchmarkBetterguid-4     	 5237756	       238.2 ns/op	      24 B/op	       1 allocs/op
	BenchmarkBetterguid-8     	 4209060	       283.9 ns/op	      24 B/op	       1 allocs/op
	BenchmarkBetterguid-16    	 3385502	       359.8 ns/op	      24 B/op	       1 allocs/op

